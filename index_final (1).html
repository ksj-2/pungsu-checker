<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìš°ë¦¬ì§‘ í’ìˆ˜ ì§„ë‹¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { overflow-x: hidden; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-200">
  
  <div id="app"></div>

  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"></script>

  <script>
    // Reactì™€ ReactDOM í™•ì¸
    if (!window.React || !window.ReactDOM) {
      document.getElementById('app').innerHTML = '<div style="color: red; padding: 50px; text-align: center; font-size: 20px;">React ë¡œë”© ì‹¤íŒ¨! ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</div>';
      throw new Error('React not loaded');
    }

    const { useState, useEffect, createElement: h } = React;
    const { createRoot } = ReactDOM;

    // ìƒìˆ˜ ì •ì˜
    const INITIAL_FORM_DATA = {
      address: '', floor: '', buildingType: '', direction: '',
      balconyView: [], riverShape: '', sunlightHours: '',
      alleyPosition: '', terrain: [], balconyExpanded: ''
    };

    // Mock API
    async function analyzeFengShui(formData) {
      await new Promise(r => setTimeout(r, 1500));
      return {
        totalScore: 88,
        grade: "í›Œë¥­í•œ í„°",
        emoji: "ğŸŒŸ",
        positiveItems: [{
          title: "ê¸ˆì„±í™˜í¬ (é‡‘æ˜Ÿç’°æŠ±)",
          description: "ê°•ì´ ì§‘ì„ ê°ì‹¸ ì•ˆëŠ” í˜•íƒœë¡œ ì¬ë¬¼ì´ ëª¨ì´ëŠ” ëª…ë‹¹ì…ë‹ˆë‹¤.",
          reason: "ë¬¼ì€ ì¬ë¬¼ì„ ëœ»í•˜ë©°, ë¬¼ì´ ê°ì‹¸ëŠ” ê²ƒì€ ì¬ë¬¼ì´ ëª¨ì´ëŠ” í˜•êµ­ì…ë‹ˆë‹¤.",
          score: 15
        }],
        negativeItems: [{
          title: "ì„œí–¥ - ì˜¤í›„ í–‡ë¹›",
          description: "ì˜¤í›„ í–‡ë¹›ì´ ê°•í•´ ì—¬ë¦„ì— ë”ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          reason: "ì €ë… í–‡ë¹›ì€ í•˜ë£¨ì˜ ê¸°ìš´ì´ ì €ë¬¼ì–´ê°€ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.",
          score: -5
        }],
        solutions: [{
          title: "ì„œí–¥ ë¹„ë³´ì±…",
          description: "ì„œìª½ì— ë‘êº¼ìš´ ì»¤íŠ¼ì„ ì„¤ì¹˜í•˜ê³  ê´€ì—½ì‹ë¬¼ì„ ë‘ì„¸ìš”.",
          reason: "ì»¤íŠ¼ì€ ê°•í•œ ê¸°ìš´ì„ ë§‰ê³ , ì‹ë¬¼ì€ ìƒê¸°ë¥¼ ë³´ì¶©í•©ë‹ˆë‹¤."
        }]
      };
    }

    // ë©”ì¸ ì•±
    function App() {
      const [step, setStep] = useState('form'); // 'form', 'loading', 'result'
      const [formData, setFormData] = useState(INITIAL_FORM_DATA);
      const [result, setResult] = useState(null);
      const [error, setError] = useState('');

      useEffect(() => {
        if (window.lucide) window.lucide.createIcons();
        if (window.Kakao && !window.Kakao.isInitialized()) {
          window.Kakao.init('f90959efbc49398f80378e190c64ab18');
        }
      }, [step]);

      const handleSubmit = async () => {
        if (!formData.address || !formData.floor) {
          setError('ì£¼ì†Œì™€ ì¸µìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        setError('');
        setStep('loading');
        
        try {
          await new Promise(r => setTimeout(r, 2000));
          const data = await analyzeFengShui(formData);
          setResult(data);
          setStep('result');
        } catch (e) {
          setError('ë¶„ì„ ì‹¤íŒ¨: ' + e.message);
          setStep('form');
        }
      };

      const reset = () => {
        setStep('form');
        setFormData(INITIAL_FORM_DATA);
        setResult(null);
        setError('');
      };

      // ë¡œë”© í™”ë©´
      if (step === 'loading') {
        return h('div', { className: 'min-h-screen flex items-center justify-center p-4' },
          h('div', { className: 'text-center' },
            h('div', { className: 'w-20 h-20 border-4 border-slate-600 border-t-emerald-400 rounded-full animate-spin mx-auto mb-4' }),
            h('h3', { className: 'text-2xl font-bold text-emerald-400' }, 'í’ìˆ˜ ë¶„ì„ ì¤‘...'),
            h('p', { className: 'text-slate-400 mt-2' }, 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”')
          )
        );
      }

      // ê²°ê³¼ í™”ë©´
      if (step === 'result' && result) {
        return h('div', { className: 'min-h-screen p-4' },
          h('div', { className: 'max-w-2xl mx-auto' },
            h('div', { className: 'bg-slate-800 p-8 rounded-lg text-center mb-6' },
              h('div', { className: 'text-6xl mb-4' }, result.emoji),
              h('div', { className: 'text-5xl font-bold text-emerald-400 mb-2' }, result.totalScore),
              h('div', { className: 'text-sm text-slate-400' }, '/ 100ì '),
              h('h2', { className: 'text-3xl font-bold mt-4 text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400' }, 
                result.grade
              )
            ),
            
            h('div', { className: 'bg-slate-800/50 p-6 rounded-lg mb-6' },
              h('h3', { className: 'text-xl font-bold text-emerald-400 mb-4' }, 'âœ¨ ì¢‹ì€ ì '),
              ...result.positiveItems.map((item, i) => 
                h('div', { key: i, className: 'mb-3 p-4 bg-emerald-900/20 rounded' },
                  h('div', { className: 'font-bold text-emerald-300' }, item.title),
                  h('div', { className: 'text-sm text-slate-300 mt-1' }, item.description)
                )
              )
            ),

            h('div', { className: 'bg-slate-800/50 p-6 rounded-lg mb-6' },
              h('h3', { className: 'text-xl font-bold text-red-400 mb-4' }, 'âš ï¸ ì£¼ì˜í•  ì '),
              ...result.negativeItems.map((item, i) => 
                h('div', { key: i, className: 'mb-3 p-4 bg-red-900/20 rounded' },
                  h('div', { className: 'font-bold text-red-300' }, item.title),
                  h('div', { className: 'text-sm text-slate-300 mt-1' }, item.description)
                )
              )
            ),

            h('button', {
              onClick: reset,
              className: 'w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-bold rounded-lg hover:opacity-90'
            }, 'ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°')
          )
        );
      }

      // í¼ í™”ë©´
      return h('div', { className: 'min-h-screen p-4' },
        h('div', { className: 'max-w-2xl mx-auto' },
          h('header', { className: 'text-center py-8' },
            h('h1', { className: 'text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400 mb-2' },
              'ğŸ  ìš°ë¦¬ì§‘ í’ìˆ˜ ì§„ë‹¨'
            ),
            h('p', { className: 'text-slate-400' }, '150ë…„ ì „í†µ í’ìˆ˜ ì´ë¡  + AI ë¶„ì„')
          ),

          h('div', { className: 'bg-slate-800/50 p-6 rounded-lg space-y-4' },
            h('div', null,
              h('label', { className: 'block text-sm font-semibold mb-2' }, 'ì£¼ì†Œ'),
              h('input', {
                type: 'text',
                placeholder: 'ì˜ˆ) ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬',
                value: formData.address,
                onChange: (e) => setFormData({...formData, address: e.target.value}),
                className: 'w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-md focus:ring-2 focus:ring-emerald-400 focus:outline-none'
              })
            ),

            h('div', null,
              h('label', { className: 'block text-sm font-semibold mb-2' }, 'ì¸µìˆ˜'),
              h('input', {
                type: 'number',
                placeholder: 'ì˜ˆ) 7',
                value: formData.floor,
                onChange: (e) => setFormData({...formData, floor: e.target.value}),
                className: 'w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-md focus:ring-2 focus:ring-emerald-400 focus:outline-none'
              })
            ),

            error && h('p', { className: 'text-red-400 text-center' }, error),

            h('button', {
              onClick: handleSubmit,
              className: 'w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-bold rounded-lg hover:opacity-90 transition-all text-lg'
            }, 'í’ìˆ˜ ê°ì • ì‹œì‘')
          )
        )
      );
    }

    // ì•± ì‹œì‘
    try {
      const root = createRoot(document.getElementById('app'));
      root.render(h(App));
      console.log('âœ… App rendered successfully!');
    } catch (error) {
      console.error('âŒ Render error:', error);
      document.getElementById('app').innerHTML = '<div style="color: red; padding: 50px; text-align: center;">ì•± ë¡œë”© ì‹¤íŒ¨: ' + error.message + '</div>';
    }
  </script>
</body>
</html>
