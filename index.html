<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>우리집 풍수 진단 - FIX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#0f172a;color:#e2e8f0}
    .field-label{font-weight:600;font-size:0.9rem;color:#cbd5e1;margin-bottom:.5rem}
    .card{background:#11182780;border:1px solid #334155;border-radius:.6rem;padding:1rem}
    .opt-label{display:flex;gap:.5rem;align-items:center;padding:.75rem;border:1px solid #475569;border-radius:.5rem;background:#0b1220;cursor:pointer}
    .opt-label input{width:18px;height:18px}
    .opt-label.active{border-color:#10b981;background:#03241a}
    button.primary{background:linear-gradient(90deg,#10b981,#06b6d4);padding:1rem;border-radius:.6rem;font-weight:800}
    .tip{color:#22d3ee;cursor:pointer}
    .hidden-el{display:none}
    .chip{padding:.6rem 1rem;border:1px solid #475569;border-radius:.5rem;background:#0b1220}
    .chip.active{background:#059669;color:white;border-color:#059669}
    .wrap{max-width:960px;margin:0 auto;padding:1rem}
  </style>
</head>
<body>
  <main class="wrap">
    <header class="text-center my-6">
      <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">우리집 풍수 진단</h1>
      <p class="text-slate-400 mt-1">150년 전통 풍수 이론 + 카카오맵 실제 데이터</p>
    </header>
    <section id="form" class="card space-y-5">
      <div>
        <div class="field-label">주소</div>
        <input id="address-input" class="w-full chip" placeholder="예) 서울특별시 종로구 세종대로 209"/>
      </div>
      <div class="grid sm:grid-cols-2 gap-3">
        <div>
          <div class="field-label">층수</div>
          <input id="floor-input" type="number" min="1" class="w-full chip" placeholder="예) 7층"/>
        </div>
        <div>
          <div class="field-label">건물 유형</div>
          <select id="building-type-select" class="w-full chip">
            <option value="">선택하세요</option>
            <option>아파트</option><option>오피스텔</option><option>빌라/다세대</option><option>단독주택</option>
          </select>
        </div>
      </div>

      <div>
        <div class="flex items-center justify-between">
          <div class="field-label">거실 방향</div>
          <button type="button" id="btn-dir-tip" class="tip text-sm">방향 확인법</button>
        </div>
        <div id="direction-options" class="grid sm:grid-cols-2 gap-2"></div>
      </div>

      <div>
        <div class="flex items-center justify-between">
          <div class="field-label">거실 창문에서 보이는 것 (다중 선택)</div>
          <button type="button" id="btn-view-tip" class="tip text-sm">풍수 Tip</button>
        </div>
        <p class="text-xs text-slate-400 mb-2">가장 큰 창문 기준</p>
        <div id="balcony-view-options" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
      </div>

      <div>
        <div class="field-label">하루 햇빛 시간</div>
        <div id="sunlight-options" class="grid sm:grid-cols-2 gap-2"></div>
      </div>

      <div>
        <div class="field-label">집의 위치</div>
        <div id="alley-options" class="space-y-2"></div>
      </div>

      <div>
        <div class="field-label">집터 지형 (다중 선택)</div>
        <div id="terrain-options" class="grid grid-cols-2 sm:grid-cols-4 gap-2"></div>
      </div>

      <div>
        <div class="field-label">베란다 확장 여부</div>
        <div id="balcony-expanded-options" class="grid grid-cols-2 gap-2"></div>
      </div>

      <button class="primary w-full">풍수 감정 시작</button>
    </section>

    <!-- 모달 -->
    <div id="modal" class="hidden-el fixed inset-0 bg-black/50 grid place-items-center p-4">
      <div class="card max-w-lg w-full bg-slate-900">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-bold">도움말</h3>
          <button id="modal-close" class="chip">닫기</button>
        </div>
        <div id="modal-body" class="text-sm text-slate-300"></div>
      </div>
    </div>
  </main>

  <script>
  (function(){
    try {
      const FORM_OPTIONS = {
        directions: [
          { value:'남향', label:'남향 (낮 12-2시에 해가 정면)' },
          { value:'동향', label:'동향 (아침 7-9시에 해가 정면)' },
          { value:'서향', label:'서향 (오후 4-6시에 해가 정면)' },
          { value:'북향', label:'북향 (햇빛 거의 안 들어옴)' },
          { value:'잘모름', label:'잘 모르겠어요 (방향 점수 제외)' }
        ],
        viewOptions: ['산','강/하천','공원','건물','도로','아무것도 안보임'],
        sunlightOptions: [
          { value:'거의없음', label:'거의 없음 (1시간 미만)' },
          { value:'1-2시간', label:'1-2시간' },
          { value:'3시간이상', label:'3시간 이상 (이상적!)' }
        ],
        alleyOptions: [
          { value:'큰길가', label:'큰 길가' },
          { value:'골목중간', label:'골목 중간' },
          { value:'교차로모퉁이', label:'T자/교차로 모퉁이' },
          { value:'큰길T자', label:'T자형 도로 끝 (정면)' },
          { value:'y자형도로', label:'Y자형 도로 (가위 살)' },
          { value:'굽은도로바깥', label:'굽은 도로 바깥쪽 (반궁 살)' },
          { value:'막다른끝', label:'막다른 골목 끝' }
        ],
        terrainOptions: ['평지','비탈','골짜기','언덕'],
        balconyExpandedOptions: [{ value:'예', label:'예' }, { value:'아니오', label:'아니오' }]
      };

      const formData = { balconyView:[], terrain:[] };
      const $ = (sel) => document.querySelector(sel);

      function renderRadios(name, options, containerId){
        const box = document.getElementById(containerId);
        if(!box) return;
        box.innerHTML = '';
        options.forEach(o=>{
          const lbl = document.createElement('label');
          lbl.className = 'opt-label';
          lbl.innerHTML = '<input type="radio" name="'+name+'" value="'+o.value+'"/><span>'+o.label+'</span>';
          lbl.addEventListener('change', (e)=>{
            box.querySelectorAll('.opt-label').forEach(l=>l.classList.remove('active'));
            lbl.classList.add('active');
          });
          box.appendChild(lbl);
        });
      }

      function renderChips(field, values, containerId){
        const box = document.getElementById(containerId);
        if(!box) return;
        box.innerHTML = '';
        values.forEach(v=>{
          const btn = document.createElement('button');
          btn.type='button';
          btn.className='chip';
          btn.textContent=v;
          btn.addEventListener('click', ()=>{
            const idx=formData[field].indexOf(v);
            if(idx>-1){ formData[field].splice(idx,1); btn.classList.remove('active'); }
            else { formData[field].push(v); btn.classList.add('active'); }
          });
          box.appendChild(btn);
        });
      }

      function renderAll(){
        renderRadios('direction', FORM_OPTIONS.directions, 'direction-options');
        renderChips('balconyView', FORM_OPTIONS.viewOptions, 'balcony-view-options');
        renderRadios('sunlightHours', FORM_OPTIONS.sunlightOptions, 'sunlight-options');
        renderRadios('alleyPosition', FORM_OPTIONS.alleyOptions, 'alley-options');
        renderChips('terrain', FORM_OPTIONS.terrainOptions, 'terrain-options');
        renderRadios('balconyExpanded', FORM_OPTIONS.balconyExpandedOptions, 'balcony-expanded-options');
      }

      const modal = $('#modal'), modalBody = $('#modal-body');
      function openModal(html){ modalBody.innerHTML = html; modal.classList.remove('hidden-el'); }
      function closeModal(){ modal.classList.add('hidden-el'); }
      $('#modal-close').addEventListener('click', closeModal);
      $('#btn-dir-tip').addEventListener('click', ()=> openModal('<p class="leading-6">스마트폰 나침반 앱을 켜고, 거실 창을 등지고 서서 화면 각도를 확인하세요. 정남향은 낮 12~2시에 해가 정면으로 들어옵니다.</p>'));
      $('#btn-view-tip').addEventListener('click', ()=> openModal('<p>거실은 집의 중심이자 기운이 가장 많이 드나드는 곳입니다. 가장 큰 창문 기준으로 보이는 풍경을 선택하세요.</p>'));

      renderAll();

      setTimeout(()=>{
        const needs = ['direction-options','balcony-view-options','sunlight-options','alley-options','terrain-options','balcony-expanded-options'];
        let empty = needs.some(id => (document.getElementById(id)?.children.length||0) === 0);
        if(empty) renderAll();
      }, 300);
    } catch(err){
      console.error('[SAFE RENDER ERROR]', err);
      const box=document.getElementById('direction-options');
      if(box){
        ['남향','동향','서향','북향','잘모름'].forEach(v=>{
          const l=document.createElement('label'); l.className='opt-label';
          l.innerHTML='<input type="radio" name="direction" value="'+v+'"/><span>'+v+'</span>';
          box.appendChild(l);
        });
      }
    }
  })();
  </script>
</body>
</html>
